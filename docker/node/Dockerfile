FROM node:latest

# Workdir.
WORKDIR /usr/src/app

# Creating needed folders.
RUN mkdir public
RUN mkdir -p app_backup/node_modules
RUN mkdir -p app_backup/public

# Copy from host to docker container the needed files.
COPY package*.json .
COPY gulpfile.js .
COPY web/script.js .
COPY docker/node/entrypoint.sh .

# Installing gulp.
RUN npm -g config set user root
RUN npm -g install gulp
RUN npm install gulp

# Installing packages.
RUN npm install

# Run gulp tasks
RUN gulp run

# Save a backup of node modules files and those files generated by gulp tasks.
RUN cp -a /usr/src/app/node_modules /usr/src/app/app_backup/node_modules
RUN cp -a /usr/src/app/public       /usr/src/app/app_backup/public

# Starting ...
CMD [ "npm", "start" ]